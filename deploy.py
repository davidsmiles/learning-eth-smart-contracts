import json
from web3 import Web3

ganache_url = "http://127.0.0.1:7545"

web3 = Web3(Web3.HTTPProvider(ganache_url))
web3.eth.defaultAccount = web3.eth.accounts[0]


def deploycontract(w3, _abi, _bytecode, tx = None, *args):
    contract = w3.eth.contract(abi=_abi, bytecode=_bytecode)
    txhash = contract.constructor(*args).transact(tx)
    return w3.eth.getTransactionReceipt(txhash)


abi = json.loads('[{"outputs": [], "inputs": [{"type": "address", "name": "_beneficiary"}, {"type": "uint256", "name": "_goal"}, {"type": "uint256", "name": "_timelimit"}], "stateMutability": "nonpayable", "type": "constructor"}, {"name": "participate", "outputs": [], "inputs": [], "stateMutability": "payable", "type": "function", "gas": 108194}, {"name": "refundAll", "outputs": [], "inputs": [], "stateMutability": "nonpayable", "type": "function", "gas": 3488253}, {"name": "finalize", "outputs": [], "inputs": [], "stateMutability": "nonpayable", "type": "function", "gas": 63993}, {"name": "beneficiary", "outputs": [{"type": "address", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1241}, {"name": "goal", "outputs": [{"type": "uint256", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1271}, {"name": "timelimit", "outputs": [{"type": "uint256", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1301}, {"name": "deadline", "outputs": [{"type": "uint256", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1331}, {"name": "ended", "outputs": [{"type": "bool", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1361}, {"name": "funders", "outputs": [{"type": "address", "name": "sender"}, {"type": "uint256", "name": "amount"}], "inputs": [{"type": "uint256", "name": "arg0"}], "stateMutability": "view", "type": "function", "gas": 2798}, {"name": "fundersCount", "outputs": [{"type": "int128", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1421}, {"name": "refundIndex", "outputs": [{"type": "int128", "name": ""}], "inputs": [], "stateMutability": "view", "type": "function", "gas": 1451}]')
bytecode = "0x740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a052606061066f6101403934156100a157600080fd5b602061066f60c03960c05160205181106100ba57600080fd5b50610140516000556101605160015542610180518181830110156100dd57600080fd5b8082019050905060035561065756600436101561000d57610565565b600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a05263d11711a26000511415610165576308c379a0610140526020610160526010610180527f646561646c696e652072656163686564000000000000000000000000000000006101a0526101805060035442106100fd57606461015cfd5b6006546101e0526101e0516064811061011557600080fd5b600560c052602060c0200160c052602060c020338155346001820155506006805460016060518183018060405190131561014e57600080fd5b809190121561015c57600080fd5b90509050815550005b6338e771ab60005114156102f757341561017e57600080fd5b6308c379a0610140526020610160526011610180527f676f616c206e6f742061636865697665640000000000000000000000000000006101a05261018050600354421015156101d15760015447106101d4565b60005b6101df57606461015cfd5b600454156101ec57600080fd5b60016004556007546101e0526102006101e051601e818352015b600654610200511215156102205760065460075560006000f35b60006000600060006001610200516064811061023b57600080fd5b600560c052602060c0200160c052602060c0200154610200516064811061026157600080fd5b600560c052602060c0200160c052602060c020546000f161028157600080fd5b610200516064811061029257600080fd5b600560c052602060c0200160c052602060c0206000815560006001820155505b8151600101808352811415610206575b50506101e051601e606051818301806040519013156102e057600080fd5b80919012156102ee57600080fd5b90509050600755005b634bb278f360005114156103c657341561031057600080fd5b6308c379a061014052602061016052601f610180527f646561646c696e6520686173206e6f74206265656e206d6574202879657429006101a0526101805060035442101561035f57606461015cfd5b6308c379a06101e052602061020052600f610220527f696e76616c69642062616c616e6365000000000000000000000000000000000061024052610220506001544710156103ae5760646101fcfd5b600454156103bb57600080fd5b6001600455600054ff005b6338af3eed60005114156103ed5734156103df57600080fd5b60005460005260206000f350005b6340193883600051141561041457341561040657600080fd5b60015460005260206000f350005b6387963f8e600051141561043b57341561042d57600080fd5b60025460005260206000f350005b6329dcb0cf600051141561046257341561045457600080fd5b60035460005260206000f350005b6312fa6feb600051141561048957341561047b57600080fd5b60045460005260206000f350005b63dc0d3dff60005114156105165734156104a257600080fd5b610140808080600435606481106104b857600080fd5b600560c052602060c0200160c052602060c020548152505060208101905080806001600435606481106104ea57600080fd5b600560c052602060c0200160c052602060c02001548152505060409050905060c05260c051610140f350005b6313a2e117600051141561053d57341561052f57600080fd5b60065460005260206000f350005b63133309b8600051141561056457341561055657600080fd5b60075460005260206000f350005b5b60006000fd5b6100ec610657036100ec6000396100ec610657036000f3"


beneficiary = web3.eth.defaultAccount
goal = web3.toWei('200', 'Ether')
timeline = 300
receipt = deploycontract(web3, abi, bytecode, None, beneficiary, goal, timeline)
print(f'Deployed successfully on {receipt.contractAddress}')


